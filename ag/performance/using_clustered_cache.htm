---
layout: page
title: Using Clustered Caching
description: Learn how control throughput of requests on a multiple Network Director deployment using various caching techniques.
product: ag
category: learn
weight:	6
sub-nav-class: Operations
type: page
nav-title: Using Clustered Caching

---
<h2 name="top">Using Clustered Caching</h2>
  <p>Learn how to increase performance on a  multiple Network Director deployment using clustered caching. </p>
  
 
<a href="using_admin_console" class="button secondary">Using Admin Console</a>
<p></p>

  <div class = "divider1"></div>
   <h3 style="color: gray;">Table of Contents</h3>

   <ol class="table_of_contents">

 <li><a href="#introduction">Introduction</a></li>
 
 
  <li><a href="#create">How do I create a Clusterable Cache and Use it in a Policy?</a></li>
  
 

  
 



  </ol>
  <div class = "divider1"></div>






<a name="introduction">
<h3>Introduction</h3></a>

<p>In previous Policy Manager versions, a cluster of Network Director (ND) instances worked independently. So if the policy only allowed 10 requests per minute each node (instance) in an ND cluster would allow 10 requests per minute. Data was not synchronized across clusters (e.g., ND1 processed 2 requests, so there are 8 counts left, etc.).</p>
<p>  Beginning with Policy Manager version 7.2, the processing of requests can now be synchronized across a cluster of multiple ND instances within a single deployment by creating a <em>clusterable cache</em>. A clusterable cache is memory that different processes can share. </p>
<p>  For example, if you want the entire cluster to collectively only allow 10 requests per minute you can configure the ND&rsquo;s to share memory (i.e., a clusterable cache) which will hold information using counters. Then when one node receives a message and increments a counter, it&rsquo;s the same counter the other nodes are using.</p>
<p>  You can create a clusterable cache in the <strong>com.soa.grid</strong> property, and then configure properties for the  <em>Throughput Quota Policy</em>, <em>Bandwidth Quota Policy</em>, and <em>WS-Security Policy</em> to use the clustered cache. </p>
<p>You configure a clusterable cache by updating a series of configuration categories in the <em>SOA Software Administration Console &gt; Configuration</em> section.</p>

<p><a href="#top">Back to top</a></p>
<a name="create">
<h3>How do I Create a  Clusterable Cache and Use it in a Policy? </h3>
</a>
<p>Perform the following steps for each Network Director instance. </p>
<h4>Step 1: Create Clusterable Cache</h4>
<ol class="usingOrderedList">
  <li>Select <strong>com.soa.grid</strong>.</li>
  <li>Set <strong>grid.network.config.enableMulticast </strong>to <strong>false</strong>, and <strong>grid.network.config.enableTcp</strong> to <strong>true</strong>. <em>Note that the Multicast option (grid.network.config.enableMulticast) is currently not supported. </em><br />
    <br />
    <img src="images/config_soagrid.jpg" alt="" width="646" height="393" /><br />
    <br />
  </li>
  <li>In <strong>grid.network.config.peerAddresses</strong>, specify the peer address of each Network Director instance in your deployment. Omit the peer address of the current Network Director instance in the list. </li>
  <li>After completing your entries, <strong>Apply Changes</strong>.</li>
</ol>
<h4>Step 2: Use Clustered Cache  in Throughput and Bandwidth Quota Policies</h4>
<ol class="usingOrderedList">
  <li>Launch the <em>SOA Software Administration Console </em>and navigate to the <em>Configuration</em> tab. </li>
  <li>In the <em>Configuration Categories</em> section, you can select properties for the <em>Throughput Quota Policy</em> (<strong>com.soa.policyhandle.quota.throughput</strong>) or  <em>Bandwidth Quota Policy</em> (<strong>com.soa.policy.handle.quota.bandwidth</strong>).</li>
  <li>Change <strong>use.clustered.cache</strong> to <strong>True</strong> and <strong>Apply Changes</strong>.  <br />
    <br />
    <img src="images/use_clustered_cache_throughput.jpg" width="622" height="399" /><br />
  Figure. Throughput Quota Policy 
  (<strong>com.soa.policyhandle.quota.throughput</strong>)<br />
  <br />
  <img src="images/use_clustered_cache_bandwidth.jpg" width="617" height="309" /><br />
  Figure. Bandwidth Quota Policy 
  (<strong>com.soa.policy.handle.quota.bandwidth</strong>)<br />
  <br />
  </li>
  <li>For the WS-Security Policy (<strong>com.soa.policy.handle.wssp.noncecache</strong>), ND will  automatically use the clustered cache you enabled the Grid and TCP options in Step 1, otherwise the  local cache will be used.&nbsp;<br />
<br />
    <br />
    <img src="images/use_clustered_cache_wssecurity.jpg" width="639" height="310" /><br />
    Figure. WS-Security Policy 
    (<strong>com.soa.policy.handle.wssp.noncecache</strong>)<br />
  </li>
</ol>
<h4>Step 3: Restart Network Director Instances</h4>
  <ol class="usingOrderedList">
    <li>Before you can successfully use the clusterable cache, you must restart all Network Director instances after completing the configuration category changes outlined in the previous steps. </li>
  </ol>
<h4>Step 4: Synchronize Clocks </h4>
<ol class="usingOrderedList">
  <li>The Policy Manager clusterable caching logic is based on the system clock. To ensure  there is not a lag in one of the Network Director instances while processing requests, you must synchonize all system clocks so they match (i.e., by milliseconds and seconds).</li>
</ol>
<h4>Step 5: Test Policy Enforcement (Example)</h4>
<ol class="usingOrderedList">
  <li>Configure a  Throughput Quota Policy to process 10 requests per minute. </li>
  <li>Virtualize a service.</li>
  <li>Attach the Throughput Quota Policy to the virtual service.</li>
  <li>Call the virtual service from the SOAP UI.</li>
  <li>Call the virtual service 10-20 times. </li>
  <li>In approximately one minute, ten requests will be success and the remainder will fail.</li>
  <li>Review the alerts. All requests failed past the 10 requests per minute will show a quota exceeded alert.  </li>
</ol>

<p><a href="#top">Back to top</a></p>
</body>
</html>
