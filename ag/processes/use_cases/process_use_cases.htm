---
layout: page
title: Process Use Cases
description: Use cases for common process scenarios.
product: ag
category: learn
weight:	2
subcategory: Process
type: page
nav-title: Process Use Cases

---
<h2 name="top">Process Use Cases</h2>



<p>Use cases for common process scenarios. </p>
<p><strong>Note:</strong> All use cases require that you have a good working knowledge of the Policy Manager Process functionality (see Getting Started, Process Reference, and Managing Process reference buttons below), and the Policy Manager 7.0 script functionality,  Policy Manager Scripting API, and available documentation and tools. See <a href="getting_started_with_processes.htm"> Getting Started with Scripts</a> for more information.</p>
<a href="getting_started_with_processes.htm" class="button secondary"> Getting Started</a>

<a href="process_reference.htm" class="button secondary">Process Reference</a>

<a href="process_management.htm" class="button secondary">Managing Processes</a>


<p></p>


<div class = "divider1"></div>
<h3 style="color: gray;">Table of Contents</h3>

<ol class="table_of_contents">

<li><a href="#How_do_I_add_or_remove_http_headers_for_my_api_or_control_the_headers_sent_and_received_between_the_gateway_and_the_backend_service">How do I add or remove HTTP headers for my API, or control the headers sent and received between the gateway and the back-end service?</a></li>


<li><a href="#How_do_i_route_based_on_the_content_of_my_json_message">How do I route based on the content of my JSON message?</a></li>

<li><a href="#How_do_i_route_based_on_the_consumer_identity">
   How do I route based on consumer identity (e.g. how do I divert traffic from one or more specific customers to a new endpoint)?</a></li>

   <li><a href="#How_do_i_call_an_external_service_or_reusable_script_process_to_determine_where_to_route_my_requests">
   How do I call an external service or reusable script/process to determine where to route my requests?</a></li>


      <li><a href="#How_do_i_change_the_structure_of_my_json_message?">
  How do I change the structure of my JSON message?</a></li>

  <li><a href="#How_do_i_augment_the_content_in_my_message_xml_or_json_by_calling_an_external_service">
  How do I augment the content in my message (XML or JSON) by calling an external service?</a></li>

   <li><a href="#How_do_i_route_ten_percent_of_my_traffic_to_a_new_endpoint">
  How do I route 10% of my traffic to a new endpoint?</a></li>

     <li><a href="#How_do_call_multiple_services_to_build_a_single_response_to_a_request">How do I call multiple services to build a single response to a request?</a></li>


 <li><a href="#How_do_create_a_rest_json_api_with_well_structured_content_from_a_soap_service">How do I create a REST/JSON API with well structured content from a SOAP service?</a></li>

</ol>
  <div class = "divider1"></div>


<a name="How_do_I_add_or_remove_HTTP_headers_for_my_api_or_control_the_headers_sent_and_received_between_the_gateway_and_the_backend_service"><h3>How do I add or remove HTTP headers for my API, or control the headers sent and received between the gateway and the back-end service?</h3></a>

<p>This use case illustrates how to manipulate the  header section of HTTP messages that are sent and received from a  virtual service operation. This optional part of the HTTP message can be used to process additional information (e.g., date/time stamp, account IDs, etc.) in the context of processing a method call.</p>
<h5>Prerequisites</h5>
<ul class="usingOrderedList">
  <li>Start all SOA Containers (i.e., Policy Manager, Network Director, Agent).</li>
  <li>Virtualize the service you would like to apply the use case to. Note that all process configuration is performed at the service operation level. </li>
</ul>

<h5>Step 1: Create a Script for Manipulating Headers</h5>
<p>Use <strong>Add Script</strong> to create a  script function for manipulating headers using the JavaScript language option, for example:</p>
<p><strong>function</strong> addHttpHeader(<strong>headerName</strong>, <strong>headerValue</strong>) {<br>
  headers = processContext.getMessage().getTransportHeaders();<br>
  headers.add(<strong>headerName</strong>, <strong>headerValue</strong>);<br>
  }<br>
  <br>
  <img src="addhttpheader_script.jpg" width="600" height="414"></p>
<p>How does this sample script  work?</p>
<ul class="usingUnorderedList">
  <li>The script reads the header from the processContext (.getMessage and .getTransport).</li>
  <li>The transport header is part of the inbound context in the process.</li>
  <li>The  JavaScript function adds a  new value to the header. </li>
</ul>
<p>Refer to the <a href="http://docs.soa.com/ag/assets/index.html" >Policy Manager Scripting API</a> for more information on the processContext.</p>
<h5>Step 2: Review Service</h5>
<p>The virtual service operation used in this example contains multiple bindings (SOAP 1.1, SOAP 1.2, and HTTP), and a REST and SOAP access point in the same container.</p>
<p><img src="usecase1_virtual_service_access_point.jpg" width="765" height="224"></p>
<p>Let's take a look at the REST binding. If we invoke the RESTful access point there is a binding that looks at the requests and determines which operation the requests maps itself to.</p>
<p>For example, the <strong>add</strong> method of the REST binding is an HTTP POST on the root URL and it accepts and returns the specified Â inputSerialization and output Serialization context items. You have similar mappings for each of the methods (i.e., get, list, delete, update). Based on how the service is invoked the binding is going to determine what operation will be invoked.</p>
<p><img src="view_wsdl_methods.jpg" width="751" height="231"></p>
<h5>Step 3: Invoke Service and Review Logging</h5>
<p>Next using an HTTP client we are going to invoke the <strong>list</strong> service and review the logs. In the <em>Services &gt; Operations &gt; Monitoring &gt; Logs</em> section for the <strong>list</strong> service, we are going to select <strong>View Usage Record Details</strong> and the <em>Recorded Messages</em> tab. From the logs we can see that the application sent a request that resulted in a downstream SOAP request, that resulted in a downstream SOAP response, and we sent a JSON document back to the client. </p>
<p><img src="usecase1_monitoring_logs_initial.jpg" width="567" height="514"></p>
<p>&nbsp;</p>
<h5>Step 4: Add New Header to Process using Script Activity</h5>
<p>Next we are going to edit the Process for the  <strong>list</strong> operation, and insert a  <em>Script Activity</em> to manipulate the headers. The initial <em>Process</em> page for the <strong>list</strong> operation will include a default process as shown below:</p>
<p><img src="list_default_process.jpg" width="571" height="235"></p>
<p>Add a<em> Script Activity</em> by dragging the icon from the Process Pallette and  wire it into the process by dragging and dropping the links  as shown below:</p>

<p><img src="list_add_script_activity.jpg" width="568" height="280"></p>
<p>Double-click the Script Activity to launch the <em>Script Details Editor</em>. In the <em>Source</em> section select the language the <strong>addhttpheader</strong> script was written in (i.e., JavaScript for this example). The checkbox for that script will become available in the <em>Available Scripts</em> section. Select the checkbox for <strong>addhttpheader</strong> and copy the script using <strong>&lt;&lt; </strong>to the <em>Imported Scripts</em> section. </p>
<p>In the <em>Script</em> section, add a header by  invoking the <strong>addhttpheader</strong> function that you defined as  an import (in Step 1)  and giving it some parameters, as shown below:</p>
<p><img src="import_script.jpg" width="605" height="413"></p>

<p>Save the Script (<strong>Finish</strong>), and then save the Process (<strong>Save</strong> icon in the Process Palette). As soon as the process is saved, Network Director will discover the process and start executing it.</p>

<h5>Step 5: Send Request and Verify  Header </h5>
<p>As a final step, use an  HTTP client to test the <strong>addhttpheader</strong> function you added to the process. Send another request, receive a response, and review the new header. If everything is configured correctly, you will see the header parameters (<strong>TestHeader</strong> and <strong>TestValue</strong>) that you defined in the <em>Script Activity</em> displayed in the message similar to the following:</p>
<p><img src="test_header.jpg" width="183" height="133"></p>
<h5>Step 6: What's Next?</h5>
<p>So manipulating headers is as simple as that. You add a script and you can do things to the processContext through the script. A very nice, very simple, and powerful technique. A few important things to note:</p>
<ul class="usingUnorderedList">
  <li>Processes are configured at the service operation level, not the service level.</li>
  <li>The header function must be added to the process definition of each operation (i.e., method) you want headers to be present for. </li>
  <li>Having a library of scripts helps to speed up the process configuration cycle.</li>
  <li>If you will be implementing a similar process on multiple service operations, you can externalize the process as a set of shared components. To do this, in the  <em>Processes</em> folder of the Organization use <strong>Add Process</strong> to define the common process, and reference the Process definition in each service operation using the <em>Process Activity</em>.</li>
</ul>
<p></p>

<p><a href="#top">back to top</a>
</p>


<a name="How_do_i_route_based_on_the_content_of_my_json_message"><h3>How do I route based on the content of my JSON message?</h3></a>

<p></p>

<p><a href="#top">back to top</a></p>

<a name="How_do_i_route_based_on_the_consumer_identity"><h3>How do I route based on consumer identity (e.g. how do I divert traffic from one or more specific customers to a new endpoint)?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>


<a name="How_do_i_call_an_external_service_or_reusable_script_process_to_determine_where_to_route_my_requests"><h3>How do I call an external service or reusable script/process to determine where to route my requests?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>


<a name="How_do_i_change_the_structure_of_my JSON message"><h3>How do I change the structure of my JSON message?</h3></a>

<p></p>


<p><a href="#top">back to top</a>
</p>


<a name="How_do_i_augment_the_content_in_my_message_xml_or_json_by_calling_an_external_service"><h3>How do I augment the content in my message (XML or JSON) by calling an external service?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>


<a name="How_do_i_route_ten_percent_of_my_traffic_to_a_new_endpoint"><h3>How do I route 10% of my traffic to a new endpoint?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>

<a name="How_do_call_multiple_services_to_build_a_single_response_to_a_request"><h3>How do I call multiple services to build a single response to a request?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>

<a name="How_do_create_a_rest_json_api_with_well_structured_content_from_a_soap_service"><h3>How do I create a REST/JSON API with well structured content from a SOAP service?</h3></a>

<p></p>

<p><a href="#top">back to top</a>
</p>


<div class = "divider1"></div>
</div>
</body>
</html>